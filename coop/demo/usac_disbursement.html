<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Federal Support to Price Cap Carriers w/o results</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
.mapboxgl-popup {
max-width: 400px;
font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
</style>
<div id="map"></div>
<script>

	var sac_remain_URL = 'mapbox://conexon-design.sac_remain';
	var sac_remain_SourceLayer = 'sac_remain';
	var unserved_1_URL = 'mapbox://conexon-design.unserved_1';
	var unserved_1_SourceLayer = 'unserved_1';
	var unserved_2_URL = 'mapbox://conexon-design.unserved_2';
	var unserved_2_SourceLayer = 'unserved_2';
	var unserved_3_URL = 'mapbox://conexon-design.unserved_3';
	var unserved_3_SourceLayer = 'unserved_3';
	var unserved_4_URL = 'mapbox://conexon-design.unserved_4';
	var unserved_4_SourceLayer = 'unserved_4';
	var unserved_5_URL = 'mapbox://conexon-design.unserved_5';
	var unserved_5_SourceLayer = 'unserved_5';
	var unserved_6_URL = 'mapbox://conexon-design.unserved_6';
	var unserved_6_SourceLayer = 'unserved_6';			

	var SACUrl = 'mapbox://conexon-design.sac';
	var SACSourceLayer = 'sac';

	var unservedFill = '#FFA500';
	var blackBorder = '#000000';
	var SACFill = '#0000FF'
	var SACSelectFill = '#0000FF';

	mapboxgl.accessToken = 'pk.eyJ1IjoiY29uZXhvbi1kZXNpZ24iLCJhIjoiY2pvdzZlb2djMXVhOTN3bmhpYzk3NndoZCJ9.On4IrAd0sgmmgd_sAqg_Gg';
	var map = new mapboxgl.Map({
		container: 'map',
		hash: true,
		// style: 'mapbox://styles/mapbox/streets-v11',
		style: 'mapbox://styles/conexon-design/cjow6vt3sax7q2rpbj5wm7s84',
		center: [-91.96, 38.02],
		minZoom:4,
		maxZoom: 10,
		zoom: 4
	});


	map.on('load', function() { 
	//the unaccoutned for sac remain
	map.addLayer({
	  id: 'sac_remain',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: sac_remain_URL,
	  },
	  'source-layer': sac_remain_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.1,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});	
	//unserved layer
	map.addLayer({
	  id: 'unserved_1',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_1_URL,
	  },
	  'source-layer': unserved_1_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});
	map.addLayer({
	  id: 'unserved_2',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_2_URL,
	  },
	  'source-layer': unserved_2_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});	
	map.addLayer({
	  id: 'unserved_3',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_3_URL,
	  },
	  'source-layer': unserved_3_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});
	map.addLayer({
	  id: 'unserved_4',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_4_URL,
	  },
	  'source-layer': unserved_4_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});
	map.addLayer({
	  id: 'unserved_5',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_5_URL,
	  },
	  'source-layer': unserved_5_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});
	map.addLayer({
	  id: 'unserved_6',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: unserved_6_URL,
	  },
	  'source-layer': unserved_6_SourceLayer,
	  // filter: ['>', 'fcc_904', 0],
	  paint: {
	    'fill-color': unservedFill,
	    'fill-opacity': 0.7,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});

	//SAC layer
	map.addLayer({
	  id: 'sac_poly',
	  type: 'fill',
	  source: {
	    type: 'vector',
	    url: SACUrl,
	  },
	  'source-layer': SACSourceLayer,
	  paint: {
	    'fill-color': SACFill,
	    'fill-opacity': 0.1,
	    'fill-outline-color': blackBorder,
	  },
	  layout: {
	    visibility: 'visible',
	  },
	});

	
	map.addLayer({
      id: 'SAC_Lines',
      type: 'line',
      source: {
        type: 'vector',
        url: SACUrl,
      },
      'source-layer': SACSourceLayer,
      paint: {
        'line-color': SACFill,
        'line-width': 1.1,
      },
      layout: {
        visibility: 'visible',
      },
    });

    //*change the color of the area
    map.on('click', 'sac_poly', (event) => {
      // set the paint property with an expression
      map.setPaintProperty('sac_poly', 'fill-color', [
        'case',
        ['==', ['get', 'sac'], event.features[0].properties.sac],
        'red',
        SACSelectFill,
      ]);
      map.setPaintProperty('sac_poly', 'fill-opacity', [
        'case',
        ['==', ['get', 'sac'], event.features[0].properties.sac],
        0.4,
        0.1,
      ]);
      //reset the other selected
      map.setPaintProperty('sac_remain', 'fill-color', unservedFill);
      map.setPaintProperty('sac_remain', 'fill-opacity', 0.1);

    });
    //*/


	// When a click event occurs on a feature in the states layer, open a popup at the
	// location of the click, with description HTML from its properties.
	map.on('click', 'sac_poly', function(e) {
	new mapboxgl.Popup()
	.setLngLat(e.lngLat)
	.setHTML(e.features[0].properties.co_lower + 
		" has received the federal support shown below " + 
		" to deliver broadband in the red shaded area. " + 
		"Even with this support, the orange shaded areas " +
		"still lack access to basic broadband services, such as services that are widely available in urban and suburban areas. " + 
		'<table border = "1"> <tr> <th> Program </th> <th> Support since 2015</th></tr>' + 
		"<tr> <td> " + "High Cost" + " </td> <td> " + e.features[0].properties.high_cost + " </td> </tr> " +
		"<tr> <td> " + "CAF" + " </td> <td> " + e.features[0].properties.caf + " </td> </tr> " +
		"<tr> <td> " + "Total" + " </td> <td> <b>" + e.features[0].properties.total + " </b></td> </tr> " +
		"</table> " +
		'<p style="font-size:9px"> ' + 
		'Source: The Universal Service Administrative Co Funding Disbursement Tool - https://www.usac.org;  <br>'+ 
		'FCC Form 477 - http://www.fcc.gov. <br>' + 
		'Unserved is defined as lacking 25/3 service ' +
		'</p>' 

		)
	.addTo(map);
	});

    //*change the color of the area
    map.on('click', 'sac_remain', (event) => {
      // set the paint property with an expression
      map.setPaintProperty('sac_remain', 'fill-color', [
        'case',
        ['==', ['get', 'state_abbv'], event.features[0].properties.state_abbv],
        'red',
        SACSelectFill,
      ]);
      map.setPaintProperty('sac_remain', 'fill-opacity', [
        'case',
        ['==', ['get', 'state_abbv'], event.features[0].properties.state_abbv],
        0.8,
        0.1,
      ]);
      //reset the other selection one
      map.setPaintProperty('sac_poly', 'fill-color', SACSelectFill);
      map.setPaintProperty('sac_poly', 'fill-opacity', 0.1);

    });
    //*/

	map.on('click', 'sac_remain', function(e) {
	new mapboxgl.Popup()
	.setLngLat(e.lngLat)
	.setHTML(
		"USAC reports and distributes money based on the Study Area Code (SAC) geography." +
		"There is no wall to wall publically avaialble dataset for SACs, " +
		"leaving the public to guess at where these funds are meant to provide service." +
		"The red shaded area represents the accounted for funds presented below in " + 
		e.features[0].properties.state_name + ".<br>" +
		'<table border = "1"> <tr> <th> Statistic </th> <th> Amount</th></tr>' + 
		"<tr> <td> " + "High Cost" + " </td> " + 
		    "<td>" + e.features[0].properties.unacc_hc + "</td> </tr>" +
		"<tr> <td> " + "CAF" + " </td> " + 
		    "<td>" + e.features[0].properties.unacc_caf + " </td> </tr>" +
		"<tr> <td> " + "TOTAL" + " </td> " + 
		    "<td>" + e.features[0].properties.total + " </td> </tr>" +
		"<tr> <td> " + "Number of SACs unaccounted for " + " </td> " +
		    "<td>" + e.features[0].properties.num_sac + " </td> </tr>" +
		"</table> " 
		)
	.addTo(map);
	});

	// Change the cursor to a pointer when the mouse is over the states layer.
	map.on('mouseenter', 'sac_poly', function() {
	map.getCanvas().style.cursor = 'pointer';
	});
 
	// Change it back to a pointer when it leaves.
	map.on('mouseleave', 'sac_poly', function() {
	map.getCanvas().style.cursor = '';
	});

	map.on('mouseenter', 'sac_remain', function() {
	map.getCanvas().style.cursor = 'pointer';
	});
 
	// Change it back to a pointer when it leaves.
	map.on('mouseleave', 'sac_remain', function() {
	map.getCanvas().style.cursor = '';
	});	
});

</script>
 
</body>
</html>